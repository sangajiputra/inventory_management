"use strict";var spinner='<div class="spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div>';function windowResize(){var t=window.innerHeight-390;$(".scrollable").css({height:t+"px"})}window.addEventListener("resize",windowResize),windowResize(),localStorage.setItem("order_note",""),localStorage.setItem("shippingDetail","");var storageTaxType=localStorage.getItem("taxType"),discountOn=localStorage.getItem("discountOn");""!=storageTaxType&&null!=storageTaxType||(storageTaxType="exclusive",localStorage.setItem("taxType",storageTaxType)),""!=discountOn&&null!=discountOn||(discountOn="before",localStorage.setItem("discountOn",discountOn)),$("[data-label='pos-settings']").attr("data-settings-tax",storageTaxType),$("[data-label='pos-settings']").attr("data-settings-discount",discountOn),$("#customers").select2(),$("#add-discount-type").select2({dropdownParent:$("#add-item-body")});var stack=[];$(document).on("click",".item-edit",function(t){$(".modal-dialog").removeClass("modal-lg");var e=$(this).parent().siblings().eq(0).children().eq(1).val(),a=($(this).parent().siblings().eq(2).children().children("input").attr("data-item_tax"),$(this).attr("data-discount")),i=$(this).attr("data-discount-type"),n=$(this).parent().siblings().eq(0).children().eq(2).val(),o=$(this).parent().siblings().eq(3).children().val(),d=$(this).parent().siblings().eq(0).children().eq(2).attr("data-desc"),e=e.split(",");$("#edit-item-name").val(n),$("#edit-item-desc").val(d),$("#edit-item-discount").val(a),$("#edit-discount-type").val(i),$("#edit-discount-type").trigger("change"),$("#edit-item-discount").on("keyup",function(){"%"==$("#edit-discount-type :selected").val()&&100<parseFloat(validateNumbers($("#edit-item-discount").val()))&&(swal(jsLang("Discount amount can not be more than 100%"),{icon:"error"}),$("#edit-item-discount").val("")),"$"==$("#edit-discount-type :selected").val()&&parseFloat(validateNumbers($("#edit-item-discount").val()))>o&&(swal(jsLang("Discount amount can not be more than the total amount"),{icon:"error"}),$("#edit-item-discount").val(""))}),$("#individual_tax").selectpicker("val",e),$(this).parent().parent().attr("modal","on")}),$("#editItemModal").on("show.bs.modal",function(){$("#individual_tax").on("change",function(){0==$("#individual_tax").val()&&$(".filter-option-inner-inner").text(jsLang("Nothing Selected"))}),$("#edit-discount-type").select2({dropdownParent:$("#editItemModalBody")})}),$(".add-item").on("show.bs.modal",function(){$("#discount-type").select2({dropdownParent:$("#add-item-body")})}),$("#editItemModal").on("hide.bs.modal",function(t){$("#itemAdded tr").removeAttr("modal")}),$(document).on("click","#editItemModalSubmitBtn",function(t){editItem(),$("#editItemModal").modal("toggle")}),$("#holdPayModal").on("show.bs.modal",function(t){var e=$(t.relatedTarget),t=$(this);t.find(".modal-body").html(spinner),t.find(".modal-dialog").removeClass("modal-lg"),t.find("#holdPayModalLabel").text(jsLang("Payment")),t.find(".modal-body").load(e.data("remote"))}),$(document).on("click","#holdPayModalSubmitBtn",function(t){var e=$(this).attr("order_id"),a=$(this).attr("order_amount"),i=$("#amount_received").val(),n=$("#payment_type").val(),o="";"card"==n?o=JSON.stringify({number:$("#card_number").val(),additional_data:$("#additional_data").val()}):"cheque"==n&&(o=JSON.stringify({number:$("#cheque_number").val(),additional_data:$("#additional_data").val()}));var d=SITE_URL+"/pos/hold-order-payment";if(""==i||parseFloat(i)<parseFloat(a))return swal(jsLang("Paid amount can not be less than bill."),{icon:"error"}),!1;$.ajax({type:"POST",url:d,data:{_token:token,order_id:e,order_amount:a,payment_type:n,params:o,amount_received:i,payment_date:$("#payment_date").val(),reference_no:$("#reference_no").val()},success:function(t){t=JSON.parse(t);1==t.status?($(".hold_item_active").remove(),$("#holdModal").find(".single_hold_item").first().trigger("click"),0==$(".single_hold_item").length&&($("#hold_name").text(jsLang("Order Details")),$(".author").text(""),$(".orderDate").text(""),$(".customer_name").text(""),$(".orderNo").text(""),$(".total_order_amount").text(""),$(".hold_order_details table tbody").html(""),$(".hold_order_details table tfoot").html("")),window.open(SITE_URL+"/pos/print-receipt/"+t.id,"_blank")):swal(jsLang("fail"),{icon:"error",buttons:[!1,jsLang("Ok")]}),$("#holdPayModal").modal("toggle")},error:function(t){swal(jsLang("Oops! Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}),$("#holdModal").on("show.bs.modal",function(t){var e=$(t.relatedTarget),t=$(this);t.find(".modal-body").html(spinner),$("#holdModalSubmitBtn, #holdModalResetBtn").attr("disabled",!1),$("#holdModalSubmitBtn").removeClass("btn_add_customer btn_add_note btn_add_shipping btn_add_discount order_hold edit_order order_payment pos_settings"),$("#holdModalResetBtn").removeClass("btn_reset_shipping btn_hold_pay btn-primary btn-warning").removeAttr("data-target data-toggle data-remote").css("display","none"),$(".modal-dialog").removeClass("modal-lg"),"add-customer"==e.data("label")?(t.find("#holdModalSubmitBtn").text(jsLang("Submit")).addClass("btn_add_customer"),$(".modal-dialog").addClass("modal-lg"),t.find("#holdModalLabel").text(jsLang("Add Customer"))):"add-note"==e.data("label")?(t.find("#holdModalSubmitBtn").text(jsLang("Submit")).addClass("btn_add_note"),t.find("#holdModalLabel").text(jsLang("Add note to the order"))):"add-shipping"==e.data("label")?(t.find("#holdModalResetBtn").text(jsLang("Reset")).addClass("btn_reset_shipping btn-warning").hide(),t.find("#holdModalSubmitBtn").text(jsLang("Submit")).addClass("btn_add_shipping"),t.find("#holdModalLabel").text(jsLang("Shipping"))):"add-discount"==e.data("label")?(t.find("#holdModalSubmitBtn").text(jsLang("Add Discount")).addClass("btn_add_discount"),t.find("#holdModalLabel").text(jsLang("Discount"))):"order-onhold"==e.data("label")?(t.find("#holdModalSubmitBtn").text(jsLang("Put on hold")).addClass("order_hold"),t.find("#holdModalLabel").text(jsLang("Order On Hold"))):"getHold-items"==e.data("label")?($(".modal-dialog").addClass("modal-lg"),t.find("#holdModalSubmitBtn").text(jsLang("Edit the order")).addClass("edit_order"),t.find("#holdModalLabel").text(jsLang("Orders history")),t.find("#holdModalResetBtn").addClass("btn-primary btn_hold_pay").text(jsLang("Pay")).attr("data-toggle","modal").attr("data-target","#holdPayModal").attr("data-remote",SITE_URL+"/pos/order-payment").css("display","block")):"order-payment"==e.data("label")?(t.find("#holdModalSubmitBtn").text(jsLang("Pay")).addClass("order_payment"),t.find("#holdModalLabel").text(jsLang("Payment"))):"pos-settings"==e.data("label")&&(t.find("#holdModalSubmitBtn").text(jsLang("Submit")).addClass("pos_settings"),t.find("#holdModalLabel").text(jsLang("Settings"))),t.find(".modal-body").load(e.data("remote"))}),$("#shipping_cost").on("blur",function(){generateAllTotal()});var totalDiscount=0;function putOnHold(t){var i=!1,e=$("#itemAdded").serialize(),a=$("#customers").val()?$("#customers").val():1,n=localStorage.getItem("order_note"),o=localStorage.getItem("shippingDetail"),d=$("#shipping_cost").val(),s=$("#net_discount_type").val(),l=$("#net_discount").val(),r=$("#discount").text(),c=$("#net_payable").text(),u=$("#item_tax").text(),m=$("#order_id").val(),p=localStorage.getItem("taxType"),_=localStorage.getItem("discountOn"),v=$("#indivisual-discount-price").val(),h=SITE_URL+"/pos/hold";if(0==$(".input_qty").length)return swal("List empty",{icon:"error",buttons:[!1,jsLang("Ok")]}),!1;var g=!1;return $('td input[name^="item_name"],td input[name^="custom_item_name"]').each(function(t,e){""==$(e).val()&&(g=!0)}),g?(swal(jsLang("Item name can not be empty."),{icon:"error"}),!1):($(".input_qty").each(function(t,e){var a=parseFloat($(e).attr("max")),e=parseFloat($(e).val());return e<=0?(swal("Quantity can not be zero",{icon:"error",buttons:[!1,jsLang("Ok")]}),!(i=!0)):a<e?(swal(jsLang("Stock not available."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!(i=!0)):void 0}),!i&&void $.ajax({type:"POST",url:h,data:{_token:token,item_data:e,invoice_type:invoice_type,customer_id:a,tax_type:p,discount_on:_,discount_on:_,comment:n,has_comment:"on",shipping_charge:d,pos_shipping:o,pos_order_title:t,totalValue:c,total_tax:u,order_id:m,net_discount:r,other_discount_type:s,other_discount_amount:l,indivisual_discount_price:v},success:function(t){1==t?(localStorage.setItem("order_note",$("#order_note").val()),$("#holdModal").modal("toggle"),location.reload()):$("#holdModal").modal("toggle")},error:function(){swal(jsLang("Oops! Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}}))}var paymentDiscount=0;function orderPayment(){var i=!1,t=$("#itemAdded").serialize(),e=$("#customers").val(),a=$("#payment_date").val(),n=localStorage.getItem("order_note"),o=localStorage.getItem("shippingDetail"),d=$("#shipping_cost").val(),s=$("#net_discount_type").val(),l=$("#net_discount").val(),r=$("#discount").text(),c=$("#reference_no").val(),u=$("#net_payable").text(),m=$("#net_payable_no_currency").text(),p=$("#amount_received").val(),_=$("#item_tax").text(),v=$("#order_id").val(),h=$("#payment_type").val(),g=localStorage.getItem("taxType"),b=localStorage.getItem("discountOn"),y=$("#indivisual-discount-price").val(),f=$("#customers option:selected").attr("data-currency_id"),x="";"card"==h?x=JSON.stringify({number:$("#card_number").val(),additional_data:$("#additional_data").val()}):"cheque"==h&&(x=JSON.stringify({number:$("#cheque_number").val(),additional_data:$("#additional_data").val()}));var w=SITE_URL+"/pos/payment";return 0==$(".input_qty").length?($(".order_payment").attr("disabled",!1),swal("List empty.",{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):($(".input_qty").each(function(t,e){var a=parseFloat($(e).attr("max")),e=parseFloat($(e).val());return e<=0?($(".order_payment").attr("disabled",!1),swal(jsLang("Quantity can not be zero."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!(i=!0)):a<e?($(".order_payment").attr("disabled",!1),swal(jsLang("Stock not available."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!(i=!0)):void 0}),!i&&(""==p||parseFloat(validateNumbers(p))<parseFloat(validateNumbers(u))?($(".order_payment").attr("disabled",!1),swal(jsLang("Paid amount can not be less than bill."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1):void $.ajax({type:"POST",url:w,data:{_token:token,item_data:t,invoice_type:invoice_type,customer_id:e,payment_date:a,payment_type:h,params:x,comment:n,shipping_charge:d,shippingDetail:o,other_discount_type:s,net_discount:r,other_discount_amount:l,reference_no:c,totalValue:m,paid:m,amount_received:p,total_tax:_,tax_type:g,discount_on:b,order_id:v,indivisual_discount_price:y,dflt_currency_id:dflt_currency_id,customerCurrency:f},success:function(t){t=JSON.parse(t);1==t.status?($(".order_payment").attr("disabled",!1),localStorage.setItem("order_note",$("#order_note").val()),localStorage.setItem("order_note",""),localStorage.setItem("shippingDetail",""),$("#holdModal").modal("toggle"),window.open(SITE_URL+"/pos/print-receipt/"+t.id,"_blank"),location.reload()):2==t.status?swal(jsLang("Customer currency and system currency must have to be same."),{icon:"error",buttons:[!1,jsLang("Ok")]}):(swal(jsLang("fail."),{icon:"error",buttons:[!1,jsLang("Ok")]}),$("#holdModal").modal("toggle"))},error:function(){swal(jsLang("Oops! Something went wrong, please try again."),{icon:"error",buttons:[!1,jsLang("Ok")]})}})))}function delay(a,i){var n=0;return function(){var t=this,e=arguments;clearTimeout(n),n=setTimeout(function(){a.apply(t,e)},i||0)}}function getItems(t,e){var a="";$(".item_category").hasClass("item_category_active")&&(a=$(".item_category_active").attr("id")),$.ajax({url:SITE_URL+"/pos-item/search",dataType:"json",type:"POST",data:{_token:token,data:t,searchType:e,activeCategoryId:a},success:function(t){if(1==t.status_no){var e=JSON.parse(t.items),a=JSON.parse(t.sale_prices),i=JSON.parse(t.tax_type_id),n=JSON.parse(t.tax_rates),o="";if(0<e.length){$("#items_list").removeClass("no-display"),$("#empty_items_list").addClass("no-display");for(var d=0;d<e.length;d++){var s=0;null!=n[d]&&(s=n[d]);var l=SITE_URL+e[d].file_name,r="";1==e[d].is_stock_managed&&e[d].available<=0&&(r='<span class="feather icon-alert-octagon stock-out text-danger p-1"></span>');var c=null==e[d].description?"":e[d].description,o=o+'<div class="single_item">'+r+'<img src="'+l+'" alt=""><div class="item_info" data-id="'+e[d].id+'" data-tax="'+getDecimalNumberFormat(s)+'" data-tax-type="'+i[d]+'" data-stock-management="'+e[d].is_stock_managed+'" data-stock="'+e[d].available+'"><p class="item_name" data-desc="'+c+'">'+e[d].name+'</p><p class="item_price">'+getDecimalNumberFormat(a[d])+"</p></div></div>"}$("#items_list").html(o)}else $("#items_list").html(""),$("#items_list").addClass("no-display"),$("#empty_items_list").removeClass("no-display")}else $("#items_list").addClass("no-display"),$("#empty_items_list").removeClass("no-display"),swal(jsLang("No Item Found"),{icon:"error",buttons:[!1,jsLang("Ok")]})}})}$("#search").keyup(delay(function(t){getItems($(this).val(),"keyup")},500)),$(".item_category").on("click",function(){$(".item_category").removeClass("item_category_active"),$(this).addClass("item_category_active"),getItems($(this).attr("id"),"category")}),$("#refresh-btn").on("click",function(){$(".item_category").removeClass("item_category_active"),getItems("","category")});var rowNo=0;$(document).on("click",".single_item",function(){var a=$(this).children("div").eq(0).attr("data-id"),i=$(this).children("div").eq(0).attr("data-tax"),n=$(this).children("div").eq(0).attr("data-tax-type"),o=$(this).children("div").eq(0).attr("data-stock-management"),d=parseFloat($(this).children("div").eq(0).attr("data-stock")),s=$(this).children().children("p").eq(0).html(),l=$(this).children().children("p").eq(0).attr("data-desc"),r=$(this).children().children("p").eq(1).html();if("1"==o&&d<=0)swal(jsLang("Stock not available."),{icon:"error",buttons:[!1,jsLang("Ok")]});else{if($(".please_add").remove(),stack.indexOf(+a)<0){rowNo++,stack.push(+a);var c="",u=1,m="";let t='<div class="qty_spinner"><button type="button" class="decrease">-</button>',e='<button type="button" class="increase">+</button></div>';"1"==o&&(c="max = "+d,d<=0&&(u=0,t='<div class="qty_spinner"><button type="button" class="decrease danger-button">-</button>',e='<button type="button" class="increase danger-button">+</button></div>',m=" input_danger"));u='<tr id="rowId_'+a+'"><td width="3%" class="pr-0 pt-2"><span id="item_edit_'+a+'" data-id="'+a+'" data-discount="0" data-discount-type="$" class="feather icon-edit cursor-pointer item-edit" data-toggle="modal" data-target="#editItemModal"></span></td><td width="35%"><input type="hidden" name="item_id[]" value="'+a+'"><input type="hidden" name="item_tax_type_id['+a+'][]" value="'+n+'"><input type="text" id="item_name_'+a+'" class="form-control hold_item_active" data-desc="'+l+'" name="item_name[]" value="'+s+'"><input type="hidden" name="item_desc[]" value="'+l+'"><input type="hidden" name="item_discount[]" class="item-discount" value="0"><input type="hidden" name="item_discount_type[]" class="item-discount-type" value="$"><input type="hidden" name="item_tax['+a+'][]" value="'+i+'"></td><td width="18%"><input type="text" class="form-control hold_item_active input_price positive-float-number" id="item_price_'+a+'" min="0" name="item_price[]" value="'+r+'"></td><td width="22%">'+t+'<input type="text" data-item_tax="'+i+'" id="input_qty_'+a+'" class="text-right form-control input_qty'+m+' positive-float-number" name="item_qty[]" min="0" '+c+' value="'+u+'">'+e+'</td><td width="20%"><input type="text" class="form-control indivisualTotal positive-float-number" id="indivisualTotal_'+a+'" name="indivisiual_item_total_price[]" readonly value="'+r+'"></td><td><button type="button" class="btn custom-btn-small delete_row" data-rowId="'+a+'"><i class="feather icon-trash-2"></i></button></td></tr>';$(".scrollable").children().children().append(u)}else{u=validateNumbers($("#input_qty_"+a).val());u++,"1"==o&&d<u?swal(jsLang("Stock not available."),{icon:"error",buttons:[!1,jsLang("Ok")]}):(Number.isInteger(u)?$("#input_qty_"+a).val(u):$("#input_qty_"+a).val(getDecimalNumberFormat(u)),$(".input_qty").trigger("keyup"))}calculate_item_qty(),generateAllTotal()}});var count,interval,custom_row_no=0;function emailValidator(t){return new RegExp(/^[_a-z0-9-]+(\.[_a-z0-9-]+)*@[a-z0-9-]+(\.[a-z0-9-]+)*(\.[a-z]{2,4})$/).test(t)}function windowResize(){var t=window.innerHeight,e=t-390;$(".scrollable").css({height:e+"px"});t-=190;$(".item_section").css({height:t+"px"})}$(document).on("click","#custom-product-add",function(t){$(".please_add").remove();var e=jsSanitize($("#item-name").val()),a=jsSanitize($("#item-desc").val()),i=$("#unit-price").val(),n=$("#quantity-price").val(),o=$("#add-item-discount").val(),d=$("#add-discount-type").val(),s=$("#add_individual_tax").val(),l="Nothing selected"==$("[data-id='add_individual_tax']").attr("title")?"":$("[data-id='add_individual_tax']").attr("title");if(""==e)return swal(jsLang("Item name can not be empty."),{icon:"error",buttons:[!1,jsLang("Ok")]}),$("#item-name").focus(),!1;if(""==i||parseFloat(i)<0)return $("#unit-price").focus(),swal(jsLang("Price can not be negative or empty."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1;if(""==n||parseFloat(n)<=0)return $("#quantity-price").focus(),swal(jsLang("Quantity can not be zero or empty."),{icon:"error",buttons:[!1,jsLang("Ok")]}),!1;l='<tr id="rowId_0"><td width="3%" class="pr-0 pt-2"><span id="item_edit_0" data-id="0" data-discount="'+o+'" data-discount-type="'+d+'" class="feather icon-edit cursor-pointer item-edit" data-toggle="modal" data-target="#editItemModal"></span></td><td width="35%"><input type="hidden" name="custom_item_id[]" value=""><input type="hidden" name="custom_item_tax_type_id[]" value="'+s+'"><input type="text" class="form-control hold_item_active" data-desc="'+a+'" name="custom_item_name[]" value="'+e+'"><input type="hidden" name="custom_item_desc[]" value="'+a+'"><input type="hidden" name="custom_item_discount[]" class="item-discount" value="'+o+'"><input type="hidden" name="custom_item_discount_type[]" class="item-discount-type" value="'+d+'"><input type="hidden" name="custom_item_tax[]" value="'+l+'"><input type="hidden" name="custom_row_no[]" value="'+custom_row_no+'"></td><td width="18%"><input type="text" class="form-control hold_item_active input_price positive-float-number" min="0" name="custom_item_price[]" value="'+i+'"></td><td width="22%"><div class="qty_spinner"><button type="button" class="decrease">-</button><input type="text" data-item_tax="'+l+'" class="form-control input_qty positive-float-number text-right" name="custom_item_qty[]" id="input_qty_0" value="'+n+'"><button type="button" class="increase">+</button></div></td><td width="20%"><input type="text" class="form-control indivisualTotal positive-float-number" name="custom_indivisiual_item_total_price[]" readonly value="'+getDecimalNumberFormat(validateNumbers(i)*validateNumbers(n))+'"></td><td><button type="button" class="btn custom-btn-small delete_row" data-rowId="0"><i class="feather icon-trash-2"></i></button></td></tr>';$(".scrollable").children().children().append(l),generateAllTotal(),custom_row_no++;e=$("#item-name").val(""),a=$("#item-desc").val(""),i=$("#unit-price").val(""),n=$("#quantity-price").val(""),o=$("#add-item-discount").val(""),d=$("#add-discount-type").val("%"),s=$("#add_individual_tax").val("").trigger("change");$(".add-item").modal("toggle")}),$("#holdModalResetBtn").on("click",function(t){$(this).hasClass("btn_reset_shipping")&&(localStorage.setItem("shippingDetail",""),$("#name,#ship_email,#ship_street,#ship_city,#ship_state,#ship_zipCode").val(""),$("#ship_country_id").val("").trigger("change"),$("#addPosShipping").validate().resetForm(),$('button[data-label="add-shipping"]').removeClass("fill-background").addClass("btn-outline-secondary"))}),$("#holdModalSubmitBtn").on("click",function(t){if($(this).hasClass("btn_add_note"))localStorage.setItem("order_note",$("#order_note").val()),""==localStorage.getItem("order_note")?$('button[data-label="add-note"]').removeClass("fill-background").addClass("btn-outline-secondary"):$('button[data-label="add-note"]').addClass("fill-background").removeClass("btn-outline-secondary"),$("#holdModal").modal("toggle");else if($(this).hasClass("btn_add_customer"))$("#customerAdd").trigger("submit");else if($(this).hasClass("btn_add_discount")){var e=validateNumbers($("#discount_amount").val());$("#net_discount").val(getDecimalNumberFormat(e)),$("#net_discount_type").val($("#discount_type").val()),generateAllTotal(),$("#holdModal").modal("toggle")}else if($(this).hasClass("btn_add_shipping")){var a=$("#addPosShipping").serializeArray(),i={};if(0==emailValidator($("#ship_email").val()))return!1;for(var n=0;n<a.length;n++){if(""==$("#"+a[n].name).val())return i={},$("#"+a[n].name+"-error").show(),!1;$("#"+a[n].name+"-error").hide(),i[a[n].name]=a[n].value}e=JSON.stringify(i);localStorage.setItem("shippingDetail",e),$('button[data-label="add-shipping"]').addClass("fill-background").removeClass("btn-outline-secondary"),$("#holdModal").modal("toggle")}else if($(this).hasClass("order_hold"))putOnHold($("#order_title").val());else if($(this).hasClass("order_payment")){var o=!1;$('td input[name^="item_name"],td input[name^="custom_item_name"]').each(function(t,e){""==$(e).val()&&(o=!0)}),o?swal(jsLang("Item name can not be empty."),{icon:"error"}):($(".order_payment").attr("disabled",!0),orderPayment())}else if($(this).hasClass("pos_settings"))$("[data-label='pos-settings']").attr("data-settings-tax",$("#tax_type").val()),$("[data-label='pos-settings']").attr("data-settings-discount",$("#discount_on").val()),localStorage.setItem("taxType",$("#tax_type").val()),localStorage.setItem("discountOn",$("#discount_on").val()),0<$(".input_qty").length&&generateAllTotal(),$("#holdModal").modal("toggle");else if($(this).hasClass("edit_order")&&($(".please_add").remove(),""!==orderResponse)){var d=orderResponse.order.sale_order_details;$("#customers").append('<option value="'+orderResponse.customer.id+'" data-currency_id="'+orderResponse.customer.currency_id+'" selected>'+orderResponse.customer.first_name+" "+orderResponse.customer.last_name+"</option>").trigger("change");var s="";stack=[];for(n=0;n<d.length;n++){var l=d[n].unit_price,r=d[n].quantity;stack.push(d[n].item_id);var c="",u="";let t='<div class="qty_spinner"><button type="button" class="decrease">-</button>',e='<button type="button" class="increase">+</button></div>';var m="";$.each(d[n].tax_rates,function(t,e){m+=getDecimalNumberFormat(e)+"%",t<d[n].tax_rates.length-1&&(m+=", ")}),d[n].item&&null!=d[n].item_id&&1==d[n].item.is_stock_managed&&d[n].item.stock<d[n].quantity&&(t='<div class="qty_spinner"><button type="button" class="decrease danger-button">-</button>',e='<button type="button" class="increase danger-button">+</button></div>',c=" max = "+d[n].stock,u=" input_danger"),null==d[n].item_id?s+='<tr id="rowId_0"><td width="3%" class="pr-0 pt-2"><span id="item_edit_0" data-id="0" data-discount="'+getDecimalNumberFormat(d[n].discount)+'" data-discount-type="'+d[n].discount_type+'" class="feather icon-edit cursor-pointer item-edit" data-toggle="modal" data-target="#editItemModal"></span></td><td width="35%"><input type="hidden" name="custom_item_id[]" value=""><input type="hidden" name="custom_item_tax_type_id[]" value="'+d[n].tax_ids+'"><input type="text" class="form-control hold_item_active" data-desc="'+d[n].description+'" name="custom_item_name[]" value="'+d[n].item_name+'"><input type="hidden" name="custom_item_desc[]" value="'+d[n].description+'"><input type="hidden" name="custom_item_discount[]" class="item-discount" value="'+getDecimalNumberFormat(d[n].discount)+'"><input type="hidden" name="custom_item_discount_type[]" class="item-discount-type" value="'+d[n].discount_type+'"><input type="hidden" name="custom_item_tax[]" value="'+m+'"><input type="hidden" name="order_id" value="'+orderResponse.order.id+'"><input type="hidden" name="custom_row_no[]" value="'+custom_row_no+'"></td><td width="18%"><input type="text" class="form-control hold_item_active input_price positive-float-number text-right" name="custom_item_price[]" value="'+getDecimalNumberFormat(l)+'"></td><td width="22%">'+t+'<input type="text" data-item_tax="'+m+'" class="form-control input_qty positive-float-number" name="custom_item_qty[]" min="0" value='+getDecimalNumberFormat(r)+">"+e+'</td><td width="20%"><input type="text" class="form-control indivisualTotal positive-float-number" name="custom_indivisiual_item_total_price[]" readonly value='+getDecimalNumberFormat(l*r)+'></td><td><button type="button" class="btn custom-btn-small delete_row" data-rowId="0"><i class="feather icon-trash-2"></i></button></td></tr>':s+='<tr id="rowId_'+d[n].item_id+'"><td width="3%" class="pr-0 pt-2"><span id="item_edit_'+d[n].item_id+'" data-id="'+d[n].item_id+'" data-discount="'+getDecimalNumberFormat(d[n].discount)+'" data-discount-type="'+d[n].discount_type+'" class="feather icon-edit cursor-pointer item-edit" data-toggle="modal" data-target="#editItemModal"></span></td><td width="35%"><input type="hidden" name="item_id[]" value="'+d[n].item_id+'"><input type="hidden" name="item_tax_type_id['+d[n].item_id+'][]" value="'+d[n].tax_ids+'"><input type="text" id="item_name_'+d[n].item_id+'" class="form-control hold_item_active" data-desc="'+d[n].description+'" name="item_name[]" value="'+d[n].item_name+'"><input type="hidden" name="item_desc[]" value="'+d[n].description+'"><input type="hidden" name="item_discount[]" class="item-discount" value="'+getDecimalNumberFormat(d[n].discount)+'"><input type="hidden" name="item_discount_type[]"  class="item-discount-type" value="'+d[n].discount_type+'"><input type="hidden" name="item_tax['+d[n].item_id+'][]" value="'+m+'"><input type="hidden" name="order_id" value="'+orderResponse.order.id+'"></td><td width="20%"><input type="text" class="form-control hold_item_active input_price positive-float-number text-right" id="item_price_'+d[n].item_id+'" min="0" name="item_price[]" value='+l+'></td><td width="20%">'+t+'<input type="text" data-item_tax="'+m+'" id="input_qty_'+d[n].item_id+'" class="form-control input_qty '+u+' positive-float-number text-right" name="item_qty[]" min="0"'+c+" value="+r+">"+e+'</td><td width="20%"><input type="text" class="form-control indivisualTotal" id="indivisualTotal_'+d[n].item_id+' positive-float-number" name="indivisiual_item_total_price[]" readonly value='+l*r+'></td><td><button type="button" class="btn custom-btn-small delete_row" data-rowId="'+d[n].id+'"><i class="feather icon-trash-2"></i></button></td></tr>'}$("#net_discount").val(getDecimalNumberFormat(orderResponse.order.other_discount_amount)),$("#net_discount_type").val(orderResponse.order.other_discount_type),$("#shipping_cost").val(getDecimalNumberFormat(orderResponse.order.shipping_charge)),$("#order_id").val(orderResponse.order.id),$(".scrollable").children().children().html(s),calculate_item_qty(),generateAllTotal(),$("#holdModal").modal("toggle")}}),$("#scroll-start").on("mouseover",function(){var e=$(".slides");interval=setInterval(function(){count=count||1;var t=e.scrollLeft();e.scrollLeft(t-count),count+=1},150)}).on("click",function(){count<6&&(count+=1)}).on("mouseout",function(){count=0,clearInterval(interval)}),$("#scroll-end").on("mouseover",function(){interval=setInterval(function(){count=count||1;var t=$(".slides").scrollLeft();$(".slides").scrollLeft(t+count),count+=1},150)}).on("click",function(){count<6&&(count+=1)}).on("mouseout",function(){count=0,clearInterval(interval)}),window.addEventListener("resize",windowResize),windowResize(),$(document).on("keyup",".input_qty",function(){parseFloat(validateNumbers($(this).val()))<=0?($(this).val(0),$(this).addClass("input_danger"),$(this).siblings(".increase").addClass("danger-button"),$(this).siblings(".decrease").addClass("danger-button")):($(this).removeClass("input_danger"),$(this).siblings(".increase").removeClass("danger-button"),$(this).siblings(".decrease").removeClass("danger-button")),$(this).attr("max")&&(parseFloat(validateNumbers($(this).val()))>parseFloat($(this).attr("max"))?($(this).addClass("input_danger"),$(this).siblings(".increase").addClass("danger-button"),$(this).siblings(".decrease").addClass("danger-button"),$(document).attr("data-label"),$("#myForm :input").prop("disabled",!0),swal(jsLang("Stock not available."),{icon:"error"})):($(this).removeClass("input_danger"),$(this).siblings(".increase").removeClass("danger-button"),$(this).siblings(".decrease").removeClass("danger-button")));var t=$(this).val(),e=$(this).parent().parent().prev().children().eq(0).val();$(this).parent().parent().next().children().eq(0).val(getDecimalNumberFormat(validateNumbers(t)*validateNumbers(e)));calculate_item_qty()}),$(document).on("blur",".input_price",function(t){var e=$(this).val(),a=$(this).parent().next().children().eq(0).children().eq(1).val();$(this).parent().next().next().children().eq(0).val(getDecimalNumberFormat(validateNumbers(a)*validateNumbers(e)));generateAllTotal()}),$(document).on("click",".decrease",function(t){let e=validateNumbers($(this).siblings("input").val());$(this).siblings().attr("id").substring(10,this.length),$(this).siblings().attr("data-item_tax");0<parseFloat(e)&&(Number.isInteger(parseFloat(e))?$(this).siblings("input").val(--e):e<1?$(this).siblings("input").val(0):$(this).siblings("input").val(getDecimalNumberFormat(--e)),$(this).siblings("input").removeClass("input_danger"),$(this).siblings(".increase").removeClass("danger-button"),$(this).removeClass("danger-button")),$(this).siblings("input").trigger("keyup")}),$(document).on("click",".increase",function(t){var e=!0;let a=parseFloat(validateNumbers($(this).prev("input").val()));var i=$(this).prev().attr("id").substring(10,this.length);parseFloat($("#input_qty_"+i).attr("max"))<=a+1?(e=!1,swal(jsLang("Stock not available."),{icon:"error"})):($(this).prev().attr("data-item_tax"),Number.isInteger(a)?$(this).prev("input").val(++a):$(this).prev("input").val(getDecimalNumberFormat(++a))),0<$("#input_qty_"+i).val()&&($(this).siblings("input").removeClass("input_danger"),$(this).siblings(".decrease").removeClass("danger-button"),$(this).removeClass("danger-button"),$(this).prev("input")),e&&$(this).prev("input").trigger("keyup")}),$(document).on("click",".delete_row",function(){$(this).parent().parent().remove();var e=$(this).attr("data-rowId");stack=stack.filter(t=>t!=e),generateAllTotal(),calculate_item_qty()});var global_customer_id="";function editItem(){var t=$("#edit-item-name").val(),e=$("#edit-item-desc").val(),a=$("#edit-item-discount").val(),i=$("#edit-discount-type").val(),n=$("#individual_tax").val(),o=$("tr[modal='on']"),d="Nothing selected"==$("#individual_tax").siblings().eq(0).attr("title")?"0":$("#individual_tax").siblings().eq(0).attr("title");o.children().eq(4).children().eq(0).val();o.children().eq(0).children().eq(0).attr("data-discount",a).attr("data-discount-type",i),o.children().eq(1).children().eq(1).val(n),o.children().eq(1).children().eq(2).attr("data-desc",e).val(t),o.children().eq(1).children().eq(3).val(e),o.children().eq(1).children().eq(4).val(a),o.children().eq(1).children().eq(5).val(i),o.children().eq(1).children().eq(6).val(d),o.children().eq(3).children().children().eq(1).attr("data-item_tax",d),generateAllTotal()}function calculate_item_qty(){let a=0;$(".input_qty").each(function(t,e){a+=parseFloat(validateNumbers($(e).val()))}),Number.isInteger(a)?$(".item_count").text(a):$(".item_count").text(getDecimalNumberFormat(a)),generateAllTotal()}function generateAllTotal(){var n=0,o=0,d=0,t=0,s=calculateTotalPrice();$("#indivisual-discount-price").val(s);var e=$("[data-label='pos-settings']").attr("data-settings-tax"),a=""==$("#net_discount").val()?0:parseFloat(validateNumbers($("#net_discount").val()));"%"==$("#net_discount_type").val()&&(a=s*a/100),0<$(".input_qty").length?($("#itemAdded tr").each(function(){var t=validateNumbers($(this).children().eq(2).children().eq(0).val()),e=validateNumbers($(this).children().eq(3).children().eq(0).children().eq(1).val()),a=$(this).children().eq(3).children().eq(0).children().eq(1).attr("data-item_tax");(a=a.split("%, "))[a.length-1]=a[a.length-1].split("%")[0];var i=individualDiscount(t*e,validateNumbers($(this).children().eq(0).children().eq(0).attr("data-discount")),$(this).children().eq(0).children().eq(0).attr("data-discount-type")),a=individualTaxPrice(t*e,a,i,s);a.price;n+=parseFloat(a.tax),d+=t*e,o+=parseFloat(i)}),$("#discountBtn").removeAttr("disabled"),$("#paymentBtn").removeAttr("disabled"),$("#holdBtn").removeAttr("disabled")):($("#discountBtn").prop("disabled",!0),$("#paymentBtn").prop("disabled",!0),$("#holdBtn").prop("disabled",!0)),o+=a,t="exclusive"==e?d+n-o:d-o;e=validateNumbers($("#shipping_cost").val());t+=parseFloat(e),$("#subTotal").text(decimalNumberFormatWithCurrency(d)),$("#item_tax").text(decimalNumberFormatWithCurrency(n)),$("#discount").text(decimalNumberFormatWithCurrency(o)),$("#net_payable_no_currency").text(t),$("#net_payable").text(decimalNumberFormatWithCurrency(t))}function individualTaxPrice(t,e,a,i){var n=""==$("#net_discount").val()?0:parseFloat(validateNumbers($("#net_discount").val())),o=$("#net_discount_type").val(),d=calculateTaxPercent(e),s=$("[data-label='pos-settings']").attr("data-settings-tax"),l=$("[data-label='pos-settings']").attr("data-settings-discount"),r=0,c=0,e=0;return"%"==o?e=(t-a)*n/100:"$"==o&&(e=(t-a)/i*n),"after"==l?(e=t-a-e,"exclusive"==s?(r=e*d/100,c=t):"inclusive"==s&&(r=e-e/(d/100+1),c=e/(i/100+1))):"before"==l&&("exclusive"==s?(r=t*(d/100),c=t):"inclusive"==s&&(r=t-t/(d/100+1),c=t/(d/100+1))),isNaN(parseFloat(r))&&(r=0),{tax:r,price:c}}function individualDiscount(t,e,a){return"$"==a?parseFloat(e):"%"==a?parseFloat(e)*parseFloat(t)/100:void 0}function calculateTaxPercent(t){var a=0;return""!=t&&null!=t&&$.each(t,function(t,e){a+=parseFloat(validateNumbers(e))}),a}function calculateTotalPrice(){var o=0;return $(".input_price").each(function(t,e){var a=parseFloat(validateNumbers($(this).parent().parent().find(".input_qty").val())),i=parseFloat(validateNumbers($(this).parent().parent().find(".item-discount").val())),n=0,n="$"==$(this).parent().parent().find(".item-discount-type").val()?i:a*parseFloat(validateNumbers(e.value))*i/100;o+=a*parseFloat(validateNumbers(e.value))-n}),o}$(document).on("change","#customers",function(t){$("#customers option:selected").attr("data-currency_id")!=dflt_currency_id?(swal(jsLang("Customer currency and system currency must have to be same."),{icon:"error"}),$("#customers").val(global_customer_id),$("#customers").trigger("change.select2")):global_customer_id=$("#customers option:selected").val(),$("#name").val(""),$("#ship_email").val(""),$("#ship_street").val(""),$("#ship_city").val(""),$("#ship_state").val(""),$("#ship_zipCode").val(""),$("#ship_country_id").val(""),localStorage.setItem("shippingDetail",""),$('button[data-label="add-shipping"]').removeClass("green")}),$(".main-body .page-wrapper").find("#get-pos-location").length&&$(".select2").select2(),$(document).on("click","#paymentBtn",function(t){$("#customers option:selected").attr("data-currency_id")!=dflt_currency_id?(swal(jsLang("Customer currency and system currency must have to be same."),{icon:"error"}),$("#holdModalSubmitBtn").prop("disabled",!0),setTimeout(function(){$("#holdModal").modal("toggle")},1e3)):global_customer_id=$("#customers option:selected").val()});